#! /bin/bash

if [[ $# == 0 ]]
then
    OF=output.cpp
else
    OF=$1
fi
HF=${OF%.cpp}.h

TMP="_tmp.b2c"
DATE=`date`
echo "/* Autogenerated by bin2c with esseci script on $DATE */" | tee $OF $HF > /dev/null
echo "" | tee -a $OF $HF > /dev/null
echo "#include \"$HF\"" >> $OF

#write header file head..
UCASE=`echo ${OF%.cpp} | tr "[:lower:]" "[:upper:]"`
MACRO="__${UCASE}_H__"
echo "#ifndef $MACRO" >> $HF
echo "#define $MACRO" >> $HF

echo "" | tee -a $OF $HF > /dev/null

for IF in *.png
do
    echo -n "Processing $IF..."
    bin2c -c $IF $TMP
    cat $TMP >> $OF
    echo " " >> $OF
    VARNAME=${IF%.png}_png
    echo "extern const unsigned char *$VARNAME;" >> $HF
    echo "done."
done

echo "" >> $HF
echo "#endif // $MACRO" >> $HF

rm -f $TMP

cp $OF ../../src
cp $HF ../../src

exit 0
